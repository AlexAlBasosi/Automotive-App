# ConnectedDriverMobilityStarterApp
### Generated by IoT-Workbench
To override callback functions below and add application code create a file called **_app.js** in the root directory of the project

###HTTP routers:

###userRouter:

#####URL:  GET /user/carsnearby/:lat/:lng

######Callback example:  
```javascript
userRouter.onGetCarsNearby  = function(lat,lng) {
...
return response;
}
```









###MQTT connectors:
######powered By IBM IoT Foundation

###Messages from ConnectedCarDevice:

####Incoming Messages:

#####Message: sendGeoPos
#####topic: /iot-2/type/ConnectedCarDevice/id/+/evt/sendGeoPos/fmt/json

######Expected payload: 
```javascript
- lat
- lng
- name
```
######Callback example: 
```javascript
connectedCarDeviceIoTFClient.sendGeoPosMessageArrived  = function(deviceID, payload) {
...
}
```

#####Message: registerVehicle
#####topic: /iot-2/type/ConnectedCarDevice/id/+/evt/registerVehicle/fmt/json

######Expected payload: 
```javascript
- name
- license
```
######Callback example: 
```javascript
connectedCarDeviceIoTFClient.registerVehicleMessageArrived  = function(deviceID, payload) {
...
}
```



####Connect\Disconnect Messages:

#####Message: ConnectedCarDeviceConnected
#####topic: /iot-2/type/ConnectedCarDevice/id/+/mon
######Callback example: 
```javascript
connectedCarDeviceIoTFClient.onConnectedCarDeviceConnected  = function(deviceID, payload) {
...
}
```

#####Message: ConnectedCarDeviceDisconnected
#####topic: /iot-2/type/ConnectedCarDevice/id/+/mon
######Callback example: 
```javascript
connectedCarDeviceIoTFClient.onConnectedCarDeviceDisconnected  = function(deviceID, payload) {
...
}
```


###Messages from UserTracker:

####Incoming Messages:

#####Message: positionMsg
#####topic: /iot-2/type/UserTracker/id/+/evt/positionMsg/fmt/json

######Expected payload: 
```javascript
- name
- lat
- lng
```
######Callback example: 
```javascript
userTrackerIoTFClient.positionMsgMessageArrived  = function(deviceID, payload) {
...
}
```



####Connect\Disconnect Messages:

#####Message: UserTrackerConnected
#####topic: /iot-2/type/UserTracker/id/+/mon
######Callback example: 
```javascript
userTrackerIoTFClient.onUserTrackerConnected  = function(deviceID, payload) {
...
}
```

#####Message: UserTrackerDisconnected
#####topic: /iot-2/type/UserTracker/id/+/mon
######Callback example: 
```javascript
userTrackerIoTFClient.onUserTrackerDisconnected  = function(deviceID, payload) {
...
}
```





###Globals:
#####VCAP_SERVICES
VCAP_SERVICES object contains all the credentials of services bound to
this application.

For details of its content, please refer to
the document or sample of each service.
######usage example:
```javascript
var iotfCredentials = VCAP_SERVICES["iotf-service"][0]["credentials"];
console.log(iotfCredentials);
=>
{ 
  iotCredentialsIdentifier: 'a2xxk39sl6r5',
  mqtt_host: 'myOrg.messaging.internetofthings.ibmcloud.com',
  mqtt_u_port: 1883,
  mqtt_s_port: 8883,
  base_uri: 'https://myOrg.internetofthings.ibmcloud.com:443/api/v0001',
  http_host: 'myOrg.internetofthings.ibmcloud.com',
  org: 'myOrg',
  apiKey: 'a-myOrg-p6yc3aqwfy',
  apiToken: 'lQgpoOIAW_6SogZRQC'
}

```



#####connectedDevicesCache:
connectedDevicesCache contains in memory cache of connected devices data. 

You can use this cache to get the last values of all devices, all devices of a specific type or a specific device
instead of listening to message callbacks.

Every cached device is an object containing the device last values as received by the application.
In addition, it contains the last update time (e.g. the last time when values were changed in milliseconds since 1970). 
######get cached device example:
```javascript
var device = connectedDevicesCache.getConnectedDevice("myDeviceID");
console.log(device);
=>
{ 
  deviceID: 'myDeviceID',
  deviceType: 'TempCtrl',
  actualTemp: 30,
  desiredTemp : 25,
  lastUpdateTime: 1445868136123
}

```
######get cached devices of type example:
```javascript
var tempCtrlDevicesArray = connectedDevicesCache.getConnectedDevicesOfType("TempCtrl");

```
######get all cached devices example:
```javascript
var allConnectedDevicesArray = connectedDevicesCache.getConnectedDevices();

```

